\section{Homomorphy and equivalence of finite automata}

We consider again the finite automaton from chapter 2.1 and investigate the
question of structural relationship between finite automata.

We tackle the question how finite automata are related which accept the same
language. We will formalize this by the existence of certain functors between
finite automata.

For making statements about decidability wrt.\ accepted languages it is an
advantage to be able to determine a ''simplest'''' finite acceptor. We will
prove the existence of such a ''simplest'' automaton.

First, we consider some simple decidability questions answered by the following
theorems:

\begin{theorem}
Let $\fa{A}$ be a finite automaton. Then the questions $\lang{A} = \emptyset?$
and $\lang{A} = X^*?$ are decidable.
\end{theorem}

Proof:

''$\lang{A} = \emptyset$?'':

Because of $\lang{A} = \emptyset \Leftrightarrow \pathcat{G}(S, F) =
\emptyset$ this is a decidable problem (reachability in a finite graph). The
formal proof is up to the reader.

''$\lang{A} = X^*$?'':

We gave in chapter 2.1 an effective procedure for constructing a deterministic,
finite automaton $\fa{A}'$ from an automaton $\fa{A}$. From this deterministic
automaton, one can construct an automaton $\fa{B}$ accepting the complement of
$\lang{A}$. From $\lang{B} = \emptyset \Leftrightarrow \lang{A} = X^*$,
and 1) follows the claim.

\begin{definition}
$\fa{A}$ is called {\bf weakly-equivalent} to an automaton $\fa{B}$ if the
accepted languages are equal: \[ \lang{A} = \lang{B} \]
\end{definition}

\begin{theorem}[decidability of weak equivalence]
For finite automata $\fa{A}$ and $\fa{B}$ it is decidable if $\lang{A} =
\lang{B}$.
\end{theorem}

Proof: Without loss of generality we may assume that $\fa{A}$ and $\fa{B}$ are
complete and deterministic. 

From $\fa{A}$ and $\fa{B}$ using our constructions we can directly give automata
for 
\[\bar{\lang{A}}, \bar{\lang{B}}, \bar{\lang{A}} \cap
\lang{B}, \lang{A} \cap \bar{\lang{A}}\]
and also for 
\[ \lang{C} := (\bar{\lang{A}} \cap \lang{B}) \cup (\lang{A} \cap
\bar{\lang{A}}) \]

Because $\lang{A} = \lang{B} \Leftrightarrow \lang{C} = \emptyset$ which
is decidable (theorem 1) we get the proof of theorem 2.

We consider now the homomorphy between finite automata. Structure-preserving
mappings between finite automata are called {\bf automata homomorphisms}.

\begin{definition}
Let $\fa{A}, \fa{A'}$ be finite automata. A functor $\beta = (\beta', \beta'')$
is called an {\bf automata homomorphism}, if
\[ \beta' = (\pathcat{G}, \pathcat{G'}, \beta'_1, \beta'_2) \]
is a functor,
\[ \beta'': X^* \to X'^*	\]
is a monoid homomorphism, and the axioms (A1) and (A2) hold:
\begin{itemize}
  \item[(A1)] The following diagram commutes:
  
  \begin{tikzcd}[column sep=large]
  \pathcat{G} \arrow[r, "\alpha"] \arrow[d, "\beta'"] & X^* \arrow[d, "\beta''"]
  \\
  \pathcat{G'} \arrow[r, "\alpha'"] & X'^*
  \end{tikzcd}
  
  \item[(A2)] $\beta'_1(S) = S'$ and $\beta'_1(F) = F'$. 
\end{itemize}

$\beta$ is called {\bf length-preserving} $\Leftrightarrow \beta'_2(e) \in
E(G')$ for each edge $e \in E(G)$.

$\beta$ is called {\bf non-expanding} $\Leftrightarrow \beta_2'(e) \in E(G')
\cup \{ 1_e \mid e \in E(G') \}$
\end{definition}

In the following we will always identify $\beta'$ with $\beta$.

It holds:

\begin{theorem}
Given an automata homomorphism $\beta: \fa{A} \to \fa{A'}$. If
\[\beta_2(\pathcat{G}(S,F)) = \pathcat{G'}(S',F')\]
then $\beta''(\lang{A}) = \lang{A'}$.
\end{theorem}

Proof: 

''$\subset$'':

Let $u \in \lang{A}$, then there exists a path $\pi \in \pathcat{G}(S, F)$
labelled with $u$, i.e. $\alpha(\pi) = u$. Because $\beta_2(\pi) \in
\pathcat{G'}(S',F')$ by assumption, it follows $\alpha'(\beta_2(\pi)) \in
\lang{A'}$.

Because of the commutativity of the diagram it follows $ \alpha'(\beta_2(\pi))
= \beta''(\alpha(\pi))$.
\[ \Rightarrow \beta''(\lang{A}) \subset \lang{A'} \]

''$\supset$'':

Let $u' \in \lang{A'}$. Then there exists a path $\pi' \in \pathcat{G'}(S', F')$
that is labeled with $u'$: $\alpha'(\pi') = u'$.

Because $\beta_2$ is surjective on $\pathcat{G'}(S', F')$ it follows: there
exists a path $\pi$ with $\beta_2(\pi) = \pi'$ and because $\beta$ is a functor
it follows $\alpha(\pi) \in \lang{A}$.

By definition, $\beta''(\alpha(\pi)) = \alpha'(\beta_2(\pi)) = \alpha'(\pi') =
u'$, therefore $u' \in \beta''(\lang{A})$.
\[ \Rightarrow  \beta''(\lang{A}) \supset \lang{A'} \]

Together this proves \[ \lang{A'} = \beta''(\lang{A}) \]

\begin{definition}[Reduction, closed homomorphism]
Let $\fa{A}$ and $\fa{A'}$ be finite automata.

A homomorphism $\beta : \fa{A \to \fa{A'}}$ is called a {\bf reduction} from
$\fa{A}$ to $\fa{A'}$ if \[ \beta_2(\pathcat{G}(S, F)) = \pathcat{G'}(S', F') \]
and $\beta'' = id_{X^*}$.

$\beta$ is a {\bf length-preserving reduction}, if it is a reduction and the
homomorphisms is length-preserving.

$\beta$ is a {\bf non-expanding reduction}, if it is a
reduction and the homomorphisms is non-expanding.

$\beta$	 is called a {\bf closed homomorphism} or short: {\bf closed}, if it is
a homomorphism and it holds \[ \beta_1^{-1}(S') = S \quad\wedge\quad
\beta_1^{-1}(F') = F
\]

In analogy, one defines a {\bf closed reduction}.
\end{definition}

We immediately get the following corollary to theorem 3:

\begin{corollary}
\[ \beta : \fa{A} \to \fa{A'} \mbox{ reduction } \Rightarrow \lang{A} =
\lang{A'} \]
\end{corollary}

Our goal will be to transfer equivalent automata into each other using chains of
reductions.

To reach this goal, we will need a number of lemmata.

\begin{lemma}
Let $\fa{A}, \fa{B}, \fa{C}$ be complete, deterministic finite automata and let
$\beta_{\fa{A}} : \fa{C} \to \fa{A}$ and $\beta_{\fa{B}} : \fa{C} \to \fa{B}$ be
closed reductions. Then there exists a finite automaton $\fa{D}$ and reductions
$\gamma_{\fa{A}}$ and $\gamma_{\fa{B}}$ such that the following diagram
commutes:

\begin{center}
\begin{tikzcd}
&	\fa{C} \arrow[dl, "\beta_{\fa{A}}"'] \arrow[dd, dashrightarrow, "\delta"]
\arrow[dr, "\beta_{\fa{B}}"] \\
\fa{A} \arrow[dr, dashrightarrow, "\gamma_{\fa{A}}"'] 	& & \fa{B} \arrow[dl,
dashrightarrow, "\gamma_{\fa{B}}"]\\
& \fa{D} 
\end{tikzcd}
\end{center}
\end{lemma}

Proof: The idea of the proof is as follows: We create from $\fa{C}$ a new
automaton $\fa{D}$ by putting those vertices and edges into classes which will
be identified under the reductions $\beta_{\fa{A}}$ or $\beta_{\fa{B}}$. In that
way we will get the reduction $\delta$. The difficulty that arises in
identifying the edges is that the labelling of the edges has to be respected.

To realize out idea we define equivalence relations on the edges and vertices of
the graph $G_{\fa{C}} = (V_{\fa{C}}, E_{\fa{C}})$ of $\fa{C}$:

Let $v_1, v_2 \in V_{\fa{C}}$ be vertices (states). Define
\begin{eqnarray*}
v_1 \faequiv{A} v_2 & : \Longleftrightarrow & \beta_{\fa{A}}(v_1) =
\beta_{\fa{A}}(v_2) \\
v_1 \faequiv{B} v_2 & : \Longleftrightarrow & \beta_{\fa{B}}(v_1) =
\beta_{\fa{B}}(v_2)
\end{eqnarray*}

In analogy we define such an equivalence relation for the edges of the graph
$G_{\fa{C}}$.

We define now an equivalence relation on the vertices (states) of the automaton
$\fa{C}$. For $v, v' \in V_{\fa{C}}$:
\begin{eqnarray*}
v \equiv v' & :\Leftrightarrow & \mbox{there is a chain of states } v = v_1,
v_2, \ldots, v_k = v'\mbox{ with } \\
& & v_i \faequiv{A} v_{i+1}\mbox{\quad or\quad }v_i \faequiv{B} v_{i+1},\quad i
= 1, \ldots, k
\end{eqnarray*} 

Obviously this defines an equivalence relation on the vertex (state) set
$V_{\fa{C}}$. We do this in the same way for the edges.

We get equivalence classes
\begin{eqnarray*}
\left[ v \right] & := & \{ v' \in V_{\fa{C}} \mid v \equiv v' \} \\
\left[ e \right] & := & \{ e' \in E_{\fa{C}} \mid e \equiv e' \}
\end{eqnarray*}

We define the sets of equivalence classes by
\begin{eqnarray*}
\bar{V} & := & \{ [v] \mid v \in V_{\fa{C}} \} \\ 
\bar{E} & := & \{ [e] \mid e \in E_{\fa{C}} \} 
\end{eqnarray*}

Claim: With $Q([e]) := [Q(e)]$ and $Z([e]) := [Z(e)],\ e \in E_{\fa{C}}$ we get
well-defined source and target mappings for the edges of the graph of
the automaton $\fa{C}$.

Proof. Let $e' \in [e]$. To prove that $Q(e') \in [Q(e)]$, we use induction over
the length of the chain $e = e_1, \ldots, e_k = e'$ where $s_i \faequiv{A}
s_{i+1}$ or $s_i \faequiv{B} s_{i+1}$ for all $i = 1,\ldots,k-1$. 

It is sufficient to show that the claim is correct for each single step. Because
$\beta_{\fa{A}}$ and $\beta_{\fa{B}}$ are functors, it holds
\[ e_i \faequiv{A} e_{i+1} \Rightarrow Q(e_i) \faequiv{A} Q(e_{i+1}) \]
and
\[ e_i \faequiv{B} e_{i+1} \Rightarrow Q(e_i) \faequiv{B} Q(e_{i+1}) \]

From this it follows that $Q$ and $Z$ are well-defined on the equivalence
classes.

Let $\bar{G} = (\bar{V}, \bar{E})$ be the graph defined by the sets of vertex
and edge equivalence classes. Define the labelling $\alpha_{\fa{D}} : \bar{E}
\to X^*$ for the edges of this graph by
\[ \alpha_{\fa{D}}([e]) := \alpha_{\fa{C}}(e) \]

This mapping is well-defined. 

Proof: Because $\beta_{\fa{A}}$ is a reduction, it holds:
\[ \alpha_{\fa{A}}(\beta_{\fa{A}}(e) = \beta''(\alpha_{\fa{C}}(e)) =
\alpha_{\fa{C}}(e) \]

This means that for each $e' \in [e]_{\fa{A}}$ we have
$\alpha_{\fa{A}}(\beta_{\fa{A}}(e')) = \alpha_{\fa{C}}(e)$. This our claim is
correct if $e \faequiv{A} e'$. The same holds for $e \faequiv{B} e'$. Together
we get that this holds for all $e \equiv e'$ so $\alpha_{\fa{D}}$ is
well-defined.

To complete the definition of the automaton $\fa{D}$ we have to define start and
final state sets.
\[ \fa{D} := (\bar{G}, X, [S_{\fa{C}}], [F_{\fa{C}}], \alpha_{\fa{D}}) \]

with final state set $[F_{\fa{C}}] := \{ [f] \mid f \in F_{\fa{C}} \}$.

Claim: The canonical mapping $e \to [e],\ v \to [v]$ is a reduction.

Proof: Exercise (Hint: use that automaton is complete and deterministic)

Finally we define the reductions $\gamma_{\fa{A}}$ and $\gamma_{\fa{B}}$ by
\begin{eqnarray*}
\gamma_{\fa{A}}(v) & := & [\beta_{\fa{A}}^-1](v),\quad v \in V_{\fa{A}} \\
\gamma_{\fa{B}}(v) & := & [\beta_{\fa{B}}^-1](v),\quad v \in V_{\fa{B}} \\
\gamma_{\fa{A}}(e) & := & [\beta_{\fa{A}}^-1](e),\quad e \in E_{\fa{A}} \\
\gamma_{\fa{B}}(e) & := & [\beta_{\fa{B}}^-1](e),\quad e \in E_{\fa{B}} \\
\end{eqnarray*}
\qed

Remark: The requirement of our lemma, that the automata have to be complete, is
essential, as the following example shows:

FIGURE

It holds: $\lang{A} = \lang{B} = \lang{C} = \{ a^n \mid n \in \mathbb{N} \}
\cup \{ b^n \mid n \in \mathbb{N} \}$.

From our construction it follows $4 \equiv 2 \equiv 1 \equiv 3$ and the
automaton $\fa{D}$ has the form

FIGURE

But $\lang{D} = \{ a, b \}^* \neq \lang{C}$. It follows:

There exists no reduction from $\fa{C}$ to $\fa{D}$ because \fa{A}, \fa{B} and
\fa{C} are not complete {\it and} deterministic.

The motivation for lemma 1 can be easily seen in the following diagram:

Let

\begin{center}
\begin{tikzcd}
& \fa{A}_2 \arrow[dl] \arrow[dr] & & \fa{A}_4 \arrow[dl] \arrow[dr] & & \fa{A}_6
\arrow[dl] \\
\fa{A}_1 & & \fa{A}_3 && \fa{A}_5
\end{tikzcd}
\end{center}

be a chain of reductions. Then we can construct automata $\fa{A}_7, \fa{A}_8$
and reductions like

\begin{center}
\begin{tikzcd}
& \fa{A}_2 \arrow[dl] \arrow[dr] & & \fa{A}_4 \arrow[dl] \arrow[dr] & & \fa{A}_6
\arrow[dl] \\
\fa{A}_1 \arrow[dr, dashed] & & \fa{A}_3 \arrow[dl, dashed] && \fa{A}_5
\arrow[dldl, dashed] \\
& \fa{A}_7 \arrow[dr, dashed] & \\
& & \fa{A}_8
\end{tikzcd}
\end{center}

such that the diagram can be ''shortened'' to

\begin{center}
\begin{tikzcd}
& \fa{A}_1 \arrow[dr] & & \fa{A}_6 \arrow[dl] \\
& & \fa{A}_8
\end{tikzcd}
\end{center}

\begin{lemma}
Let $\gamma_{\fa{A}} : \fa{A} \to \fa{D}$ and $\gamma_{\fa{B}} : \fa{B} \to
\fa{D}$ be length-preserving reductions.

Then there exists an automaton $\fa{C}$ and reductions $\beta_{\fa{A}}$ and
$\beta_{\fa{B}}$ such that the following diagram commutes:
\begin{center}
\begin{tikzcd}
& \fa{C} \arrow[dl,dashed,"\beta_{\fa{A}}"'] \arrow[dd,dashed]
\arrow[dr,dashed,"\beta_{\fa{B}}"]
\\
\fa{A} \arrow[dr,"\gamma_{\fa{A}}"'] & & \fa{B} \arrow[dl,"\gamma_{\fa{B}}"] \\
& \fa{D}
\end{tikzcd}
\end{center}
\end{lemma}

\begin{proof}
We construct the automaton 
\[ \fa{C} = (G_{\fa{C}}, X, S_{\fa{C}}, F_{\fa{C}}, \alpha_{\fa{C}}) \]
with vertex (state) set
\[ V_{\fa{C}} = V_{\fa{A}} \times V_{\fa{B}} \]
and edge set
\[ E_{\fa{C}} = \{ (e, e') \in E_{\fa{A}} \times E_{\fa{B}} \mid
\gamma_{\fa{A}}(e) = \gamma_{\fa{B}}(e') \} \]
start states
\[ S_{\fa{C}} = S_{\fa{A}} \times S_{\fa{B}} \]
final states
\[ F_{\fa{C}} = F_{\fa{A}} \times F_{\fa{B}} \]
and labelling
\[ \alpha_{\fa{C}}((e, e')) = \alpha_{\fa{A}}(e) \] 

$\beta_{\fa{A}}$ and $\beta_{\fa{B}}$ are the projections onto $\fa{A}$ and
$\fa{B}$.

Claim: $\beta_{\fa{A}}$ and $\beta_{\fa{B}}$ are reductions.

Without loss of generality we show the claim for $\beta_{\fa{A}}$ only.

\begin{enumerate}
\item $\alpha_{\fa{A}}(\beta_{\fa{A}}((e,e'))) = \alpha_{\fa{A}}(e) =
\beta''_{\fa{A}}(\alpha_{\fa{C}})(e, e') = \beta''_{\fa{A}}(\alpha_{\fa{A}})(e)$

With $\beta''_{\fa{A}}$ the equation above holds.
\item $\beta_{\fa{A}}(S_{\fa{C}}) = S_{\fa{A}}$ and $\beta_{\fa{A}}(F_{\fa{C}})
= F_{\fa{A}}$ holds by definition
\item $\beta_{\fa{A}}\Big(\pathcat{G_{\fa{C}}}(S_{\fa{C}}, F_{\fa{C}})\Big)
\stackrel{!}{=} \pathcat{G_{\fa{A}}}(S_{\fa{A}}, F_{\fa{A}})$
\end{enumerate}

Let $\pi \in \pathcat{G_{\fa{A}}}(S_{\fa{A}}, F_{\fa{A}})$ be an accepting path.
We have to show that there exists an accepting path $\pi' \in
\pathcat{G_{\fa{C}}}(S_{\fa{C}}, F_{\fa{C}})$ with $\beta_{\fa{A}}(\pi') = \pi$.

Because $\gamma_{\fa{A}}$ is a reduction, there exists an accepting path
$\pi_{\fa{D}} \in \pathcat_{\fa{D}}(S_{\fa{D}}, F_{\fa{D}})$ with
$\gamma_{\fa{A}}(\pi) = \pi_{\fa{D}}$.

Further there exists an accepting path $\pi_{\fa{B}} \in
\pathcat{G_{\fa{B}}}(S_{\fa{B}}, F_{\fa{B}})$ with
$\gamma_{\fa{B}}(\pi_{\fa{B}}) = \pi_{\fa{D}}$, because $\gamma_{\fa{B}}$ is a
reduction (and therefore is surjective).

From the paths $\pi$ and $\pi_{\fa{B}}$ we construct the path we are searching
for:
\[ \pi = e_1 \cdots e_n \qquad \pi_{\fa{D}} = \gamma_{\fa{A}}(e_1) \cdots
\gamma_{\fa{A}}(e_n) = \gamma_{\fa{B}}(\pi_{\fa{B}}) \]

Because $\gamma_{\fa{A}}$ and $\gamma_{\fa{B}}$ are length-preserving it follows
\[ \pi_{\fa{B}} = e'_1 \cdots e'_n \]
with $e'_i \in E_{\fa{B}}$.

Now create the path $\pi_{\fa{C}} = (e_1, e'_1) \cdots (e_n, e'_n) \in
\pathcat{G_{\fa{C}}}(S_{\fa{C}}, F_{\fa{C}})$.

\[ \Rightarrow \pathcat{G_{\fa{A}}}(S_{\fa{A}}, F_{\fa{A}}) \subset
\beta_{\fa{A}}(\pathcat_{\fa{C}}(S_{\fa{C}}, F_{\fa{C}})) \]
\[ \Rightarrow \pathcat{G_{\fa{A}}}(S_{\fa{A}}, F_{\fa{A}}) =
\beta_{\fa{A}}(\pathcat_{\fa{C}}(S_{\fa{C}}, F_{\fa{C}})) \]
\end{proof}

We want to treat again the question from the beginning of this section: How do
automata relate which accept the same language?

First, we want to render more precisely: How does a non-deterministic automaton
\fa{A} relate to the complete, deterministic automaton \fa{A}'?

We remember the constructions from the first section.

At first, we want to start with an $\epsilon$-free automaton with $\alpha(e)
\in X$ for each edge $e$.

Consider the step which makes this automaton initial (single start state). The
construction was as follows:

FIGURE

Let $\fa{A}_1$ be the initial automaton with start state $Z_0$.

We construct an automaton $\fa{A}'_1$ by adding for each start state $i \in
S_{\fa{A}}$ a state $i' \in V_G$ and setting $S_{\fa{A}'} = \{ 1', \ldots, k'
\}$:

FIGURE

The homomorphism $\phi : \fa{A}'_1 \to \fa{A}$ is defined by $\phi_1(i) =
\phi_1(i') = i,\ i = 1, \ldots, k$ and the identity otherwise. Then $\phi$ is a
reduction.

The homomorphism $\phi' : \fa{A}_1' \to \fa{A}$ is defined by $\phi'_1(i') =
Z_0,\ i = 1, \ldots, k$ and $\phi'_1(i) = i$. $\phi'$ is also a reduction such
that the step of make an automaton initial can be described by the following
reduction diagram:

\begin{center}
\begin{tikzcd}
& \fa{A}_1' \arrow[dl,"\phi"'] \arrow[dr,"\phi'"] \\
\fa{A} & & \fa{A}_1
\end{tikzcd}
\end{center}

The construction of the final states is totally similar.

As the next step we want to make our initial automaton $\fa{A}_1$ complete.

This is realized by introducing a new vertex (state) $\omega$ to which from all 
''incomplete'' vertices new edges with the corresponding label will be drawn.
Each edge starting from $\omega$ also ends in $\omega$.

Let's name the automaton which results from this step with $\fa{A}_2$. Obviously
we get a reduction $\phi'' : \fa{A}_1 \to \fa{A}_2$.

Now we make $\fa{A}_2$ deterministic. The resulting automaton shall be named
$\fa{A}'$.

We construct an automaton $\fa{A}_2'$ by constructing edges of the following
form:
\[ e := (\{p_1, \ldots, p_r\}, p_i) \edge{x} (\{q_1, \ldots, q_s\}, q_j) \]
if $p_i \edge{e'} q_j \in E_{\fa{A_2}}$ and $\alpha(e') = x$ for all $i = 1,
\ldots,r,\ j = 1, \ldots, s$ in the construction of the deterministic automaton.

We get homomorphisms
\[ \tilde{\phi} \mbox{ with } \tilde{\phi}(e) := (p_i \edge{x} q_j) \]
and 
\[ \hat{\phi} \mbox{ with } \hat{\phi}(e) := (\{p_1, \ldots, p_r\} \edge{x}
\{q_1, \ldots, q_s\}) \]
for all edges $e$ as described above.

Both homomorphisms are reductions.

If we compose all these reductions, we get the following diagram:

\begin{center}
\begin{tikzcd}
& \fa{A}_1' \arrow[dl] \arrow[dr] \\
\fa{A} & & \fa{A}_1 \arrow[dr] & & \fa{A}_2' \arrow[dl] \arrow[dr] \\
& & & \fa{A}_2 & & \fa{A}'
\end{tikzcd}
\end{center}

Because the composition of reductions is also a reduction, we can change this
diagram as follows:

\begin{center}
\begin{tikzcd}
& \fa{A}_1' \arrow[dl] \arrow[dr] & & \fa{A}_2' \arrow[dl] \arrow[dr] \\
\fa{A} & & \fa{A}_2 & & \fa{A}'
\end{tikzcd}
\end{center}

Because all reductions in this diagram are length-preserving, we can complete
this diagram to:

\begin{center}
\begin{tikzcd}
& & \fa{C} \arrow[dl,dashed] \arrow[dr,dashed] \\
& \fa{A}_1' \arrow[dl] \arrow[dr] & & \fa{A}_2' \arrow[dl] \arrow[dr] \\
\fa{A} & & \fa{A}_2 & & \fa{A}'
\end{tikzcd}
\end{center}

and finally to

\begin{center}
\begin{tikzcd}
& \fa{C} \arrow[dl] \arrow[dr] \\
\fa{A} & & \fa{A}'
\end{tikzcd}
\end{center}

Remark: All the reductions that we constructed for make an automaton initial,
complete and deterministic have been length-preserving. In chapter 2.1 we
additionally made a construction which transforms an automaton with labelling
$\alpha(e) \in X^*$ into an automaton with $\alpha(e) \in X$. We had to split
edges and make the automaton $\epsilon$-free. We can represent this also by
reduction diagrams but in that case the reductions are are not length-preserving
(non-expanding) anymore.

The consequence is that lemma 2 cannot be applied anymore.

We now describe these reductions informally.

\begin{enumerate}
  \item Splitting of edges:
  \[ \edge{x_1 \cdots x_k} \qquad\stackrel{\phi}{\to}\qquad \edge{x_1}\quad
  \cdots\quad \edge{x_k} \] Here, an edge is mapped to a path. The reduction
  properties are fulfilled.
  \item Removal of $\epsilon$-edges after insertion of bridges:
  
  FIGURE
  
  $\phi(e_1') = e_1 \cdot e_2,\quad Q(e_1') = Q(e_1),\quad Z(e_1') =
  Z(e_2),\quad \phi(e_2) = e_2$, identity otherwise.
  
  Here the properties of a reduction are also fulfilled.
\end{enumerate}

Let's visualize the complete construction graphically:

\begin{center}
\begin{tikzcd}
 & & & & \tilde{\fa{A}} \arrow[ld,dashed]  \arrow[rdrd,dashed] \\
 & & & \fa{A}_2'' \arrow[ld] \arrow[rd] \\
\fa{A} \arrow[rd]& & \fa{A}_2 \arrow[ld]& & \fa{A}_2' \arrow[rd] & &
\fa{A}_3'' \arrow[ld] \arrow[rd] \\
& \fa{A}_1 & & & & \fa{A}_3 & & \fa{A}' 
\end{tikzcd}
\end{center}

This diagram can be simplified after our previous considerations and using the
categorial closure of length-preserving reductions into:

\begin{center}
\begin{tikzcd}
& & & \tilde{\fa{A}} \arrow[ld] \arrow[rd] \\
\fa{A} \arrow[rd] & & \fa{A}_2 \arrow[ld] & & \fa{A}' \\
& \fa{A}_1
\end{tikzcd}
\end{center}

We can now concretize our initial goal: describing the relation between
two equivalent automata.

We want to achieve the following:

$\lang{A} = \lang{B}$, then there should exist a diagram

FIGURE

We specify for the complete, deterministic automaton a normal-form and define

\begin{definition}[reduced automaton]
A complete, deterministic automaton is called {\bf reduced} $\iff$ each
reduction $\rho : \fa{A} \to \fa{B}$ is a monomorphism (injective homomorphism).
\end{definition}

\begin{lemma}
For each complete, deterministic finite automaton $\fa{A}$ there exists a
reduced automaton $\fa{A}_r$ and a closed reduction $\rho : \fa{A} \to
\fa{A}_r$.

If $\fa{A}_r$ does not contain superfluous elements, then it is unique up to
isomorphism.
\end{lemma}

\begin{proof}
We prove first that every two automata which are reduced and belong to $\fa{A}$
are isomorphic.

Let $\rho_i : \fa{A} \to \fa{A}_i,\ i = 1, 2$ be closed reductions. We can apply
lemma 1 and get the following situation:

There exist a reduced automaton $\fa{A}_r$ and reductions $\psi_i : \fa{A}_i
\to \fa{A}_r$ with

\begin{center}
\begin{tikzcd}
& \fa{A} \arrow[ld,"\rho_1"'] \arrow[rd,"\rho_2"] \\
\fa{A}_1 \arrow[rd,"\psi_1"'] & & \fa{A}_2 \arrow[ld,"\psi_2"] \\
& \fa{A}_r
\end{tikzcd}
\end{center}

By assumption, $\fa{A}_1$ and $\fa{A}_2$ are reduced, therefore $\psi_1$ and
$\psi_2$ are monomorphisms (injective) and $\rho_1$ and $\rho_2$ are surjective,
$\fa{A}_1$ and $\fa{A}_2$	are complete and deterministic

$\Rightarrow$ the images under $\psi_1$ and $\psi_2$ are equal

$\Rightarrow \psi_1, \psi_2$ are isomorphisms on the images. 
\end{proof}

It remains to prove that for each automaton $\fa{A}$ there exists a reduces
automaton $\fa{A}_r$.

This follows from the fact that the automata are finite and is shown by the
following construction.

Remark: For simplicity (without loss of generality) we want to assume that our
automata in the following do not contain superfluous vertices (states).

We consider now a restriction of the syntactic congruence defined in chapter
1.2.

\begin{definition}
$u, v \in X^*$ are called {\bf congruent modulo $L$}, written as 
\[ u \equiv_L v :\iff \mbox{ for all } w \in X^* \mbox{ holds}\quad u \cdot w
\in L \iff v \cdot w \in L \]
\end{definition}

Notation: $[w]_L := \{ v \mid w \equiv_L v \}$
\[ X^*/L := \{ [w]_L \mid w \in X^* \} \]

With this notatation it holds

\begin{lemma}
\[ card(X^*/L) \mbox{ is finite} \iff L \in REG(X^*) \]
\end{lemma}

\begin{proof}
''$\Rightarrow$'':

One sees immediately: $w \equiv_L w' \Rightarrow w \cdot x \equiv_L w' \cdot x$

We construct the graph $G' = (X^*/L, E)$ with edge set
\[ E = \{ ([w], [wx]) \mid w \in X^*,\ x \in X \} \]
which by assumption is finite.

Set $S := \{ [e] \},\ F := \{[w] \mid w\in L \}$ and define the labelling
$\alpha$ by $\alpha(([w], [wx])) := x$.

We obtain a finite automaton \[ \fa{A} = \fa{A}(L) = (G', X, S, F, \alpha) \]
with the property $\lang{A} = L$ (exercise).

''$\Leftarrow$'':

(Translator remark: Made the proof more readable)

Let $L \in REG(X^*)$ be a regular language, then there exists a finite acceptor
$\fa{A}$ for $L$. Assume, that $\fa{A}$ is complete and deterministic with graph
$G = (V, E)$.

Consider paths $\pi$ and $\pi'$ both starting at some start state of $\fa{A}$
\[ Q(\pi) \in S,\ Q(\pi')\in S \]
with labels being congruent modulo $L$:
\[ \alpha(\pi) \equiv_L \alpha(\pi') \]

For any pair of paths $\omega, \omega'$ that can be appended to $\pi$ and $\pi'$
and which have equal labels, that is
\[ Q(\omega) = Z(\pi),\ Q(\omega') = Z(\pi'),\ \alpha(\omega) = \alpha(\omega')
\] it holds: \[ Z(\omega) \in F \iff Z(\omega') \in F \]

(Otherwise, we would have for example $Z(\omega) \in F,\ Z(\omega') \notin F$.
But from this would follow $\alpha(\pi) \cdot \alpha(\omega) \in L$ and
$\alpha(\pi') \cdot \alpha(\omega) \notin L$ which violates our assumption.)

Now assume to the opposite that for each pair of paths $\omega,
\omega'$ that can be appended to $\pi$ and $\pi'$ and $\alpha(\omega) =
\alpha(\omega')$ it holds \[ Z(\omega) \in F \iff Z(\omega') \in F \]

Then for any pair of paths $\pi, \pi'$ with 
\[Z(\pi) = Q(\omega),\ Z(\pi') = Q(\omega'),\quad Q(\pi)\in S,\ Q(\pi') \in S \]
it follows 
\[ \alpha(\pi) \equiv_L \alpha(\pi') \]

This gives us a mapping that assigns to each vertex (state) $v \in V$ a
congruence class, namely $[\alpha(\pi)]$.

From this we get: $card(X^*/L)$ is finite, especially $card(X^*/L) \leq
card(V)$.
\end{proof}

In our lemma we even proved a bit more:

Let $\rho_1 : V \to X^*/L$ with $\rho_1(v) = [u]_L$, if $\pi \in
\pathcat{G}(S, V)$ where $Z(\pi) = v$ and $\alpha(\pi) = u$ be the mapping from
the lemma. Then it holds

\begin{lemma}
$\rho_1$ induces a reduction from $\fa{A}$ to $\fa{A}(L)$.
\end{lemma}

\begin{proof}
Let $e \in E$ be an edge with $Q(e) = v, Z(e) = v'$ and $\alpha(e) = x$, then
the mapping $\rho_2$ with \[ \rho_2(e) = e' \in E(G'),\ Q(e') = [u] =
\rho_1(v),\ Z(e') = [ux] = \rho_1(v') \]
induces a reduction.
\end{proof}

We get immediately

\begin{theorem}If $\fa{A}$ is a complete, deterministic finite automaton, then
there exists a closed reduction \[ \rho : \fa{A} \to \fa{A}_L \]
\end{theorem}

\begin{proof}
Let $\rho$ be the mapping defined by $\rho_1$ and $\rho_2$. It holds:
\begin{enumerate}
  \item $\rho$ is a homomorphism
  \item $\rho_1^{-1}([L]) = F,\qquad \rho_1^{-1}([\epsilon]) = S$
  \item $\rho$ is surjective!
\end{enumerate}

$\rho_1$: clear, because to each $v \in V$ there is a corresponding congruence
class.

$\rho_2$ is surjective because $\fa{A}$ is complete.
\end{proof}

Remark: $\rho$ is even length-preserving.

\begin{corollary}
$\fa{A}(L)$ is reduced. (Exercise)
\end{corollary}

With all this we can set $\fa{A}_r := \fa{A}(L)$ and we have proved lemma 3
completely.

The question remains: how do equivalent, reduced, complete and deterministic
finite automata relate?

\begin{theorem}
If $\fa{A}$ and $\fa{B}$ are reduced, complete and deterministic finite
automata which accept the same language, then they are isomorphic.
\end{theorem}

\begin{proof}
If \fa{A} and \fa{B} are reduced, then $\fa{A} \cong \fa{A}(L) \cong \fa{B}$.
\end{proof}

\begin{corollary}
If $\fa{A}$ is equivalent to $\fa{B}$ then there exists a chain of reductions
\[ \fa{A} \longrightarrow \fa{A}_1 \longleftarrow \fa{A}_2 \longleftarrow \fa{C}
\longrightarrow \fa{B}_1 \longleftarrow \fa{B} \]
\end{corollary}

\begin{proof}
We look at the construction from figure TODO:

\begin{center}
\begin{tikzcd}[column sep=small]
& & & & & \fa{C} \arrow[lld,dashed] \arrow[rrd,dashed] & & & & & \\
& & & \tilde{\fa{A}} \arrow[ld] \arrow[rd]& & & & \tilde{\fa{B}} \arrow[ld] \arrow[rd] \\
\fa{A} \arrow[r] & \fa{A}_1 &\fa{A}_2 \arrow[l] & &\fa{A}' \arrow[rd] & &
\fa{B}' \arrow[ld] & & \fa{B}_2 \arrow[r] & \fa{B}_1 & \fa{B} \arrow[l] \\
& & & & & \fa{A}_r & & & & &
\end{tikzcd}
\end{center}

$\fa{A}_r$ exists by theorems 4 and 5. $\fa{C}$ exists by lemma 2.
\end{proof}

\begin{lemma}
Let $\gamma_{\fa{A}} : \fa{C} \to \fa{A},\ \gamma_{\fa{B}} : \fa{C} \to \fa{B}$
be length-preserving reductions.

Then there exists an automaton $\fa{A} \times \fa{B}$ and reductions
\begin{eqnarray*}
& \pi_{\fa{A}} : \fa{A} \times \fa{B} \to \fa{A} \\
& \pi_{\fa{B}} : \fa{A} \times \fa{B} \to \fa{B}
\end{eqnarray*}
such that the following diagram commutes:

\begin{center}
\begin{tikzcd}
& \fa{C} \arrow[ld,"\gamma_{\fa{A}}"'] \arrow[dd,"\delta"]
\arrow[rd,"\gamma_{\fa{B}}"] \\
\fa{A} & & \fa{B} \\
& \fa{A} \times \fa{B} \arrow[lu,"\pi_{\fa{A}}"] \arrow[ru,"\pi_{\fa{B}}"']
\end{tikzcd}
\end{center}
\end{lemma}

\begin{proof}
Let \[ G := (V_{\fa{A}} \times V_{\fa{B}}, \{ (e, e') \in E_{\fa{A}} \times
E_{\fa{B}} \mid \alpha_{\fa{A}}(e) = \alpha_{\fa{B}}(e') \}  ) \]

Then the finite automaton $\fa{A} \times \fa{B}$ is defined by
\[ \fa{A} \times \fa{B} := (G, X, S_{\fa{A}} \times S_{\fa{B}}, F_{\fa{A}}
\times F_{\fa{B}}, \alpha) \]

Let $\delta(v) = (\gamma_{\fa{A}}(v), \gamma_{\fa{B}}(v)),\ v \in V_{\fa{C}}$,
and $\delta(e) = \gamma_{\fa{A}}(e), \gamma_{\fa{B}}(e)),\ e \in E_{\fa{C}}$.

$\delta$ is a homomorphism from $\fa{C}$ to $\fa{A} \times \fa{B}$.

Now $\gamma_{\fa{A}} = \delta \circ \pi_{\fa{A}}$ and $\gamma_{\fa{B}} = \delta
\circ \pi_{\fa{B}}$ are reductions
\[ \Rightarrow \pi_{\fa{A}} \mbox{ and } \pi_{\fa{B}} \mbox{ are reductions.} \]
\end{proof}

With lemma 6 we get

\begin{theorem}
If \fa{A} is equivalent to \fa{B}, then \fa{A} can be transformed into \fa{B} by
the following chain of reductions:
\begin{center}
\begin{tikzcd}
\fa{A} \arrow[r] & \fa{A}_1 & \fa{A}_2 \arrow[l] & \fa{A}_2 \times \fa{B}_2
\arrow[l, "\pi_{\fa{A}}"'] \arrow[r, "\pi_{\fa{B}}"] & \fa{B}_2 \arrow[r] &
\fa{B}_1 & \fa{B}
\arrow[l]
\end{tikzcd}
\end{center}
\end{theorem}

\begin{proof}
Our constructions above.
\end{proof}

We can now give a {\bf decision algorithm} for the equivalence of finite
automata \fa{A} and \fa{B}.

\begin{enumerate}
  \item From \fa{A} and \fa{B} construct the automata $\fa{A}_2$ and $\fa{B}_2$.
  \item Check if 
  \begin{tikzcd} \fa{A}_2 & \fa{A}_2 \times \fa{B}_2
		\arrow[l, "\pi_{\fa{A}}"'] \arrow[r, "\pi_{\fa{B}}"] & \fa{B}_2 
	\end{tikzcd}
	are reductions. If this is the case, $\lang{A} = \lang{B}$.
\end{enumerate}

We want to specify the {\bf complexity} of this decision algorithm:

As measure of complexity of \fa{A} we define 
\[ \|\fa{A}\| := \sum_{e \in E} |\alpha(e)| \]

\begin{tabular}{ll}
  ''Splitting'' the edges: & $O(\|\fa{A}\|)$ \\  \\
  Creating the bridges: & $(card(E))^2$ \\ \\
  Transitive closure of $\epsilon$-graph & $O(\|\fa{A}\|^3)$ \\  \\
  Construction of $\fa{A} \times \fa{B}$: & $\|\fa{A}\| \cdot \|\fa{B}\|$ \\ \\
  Test for reduction \\
  1. Removal of superfluous states: & $O(\|\fa{A}\|^3)$ \\
  2. Surjectivity test on the rest: & $O(2^{\|\fa{A}\|})$
\end{tabular}

The test for surjectivity takes most of the time and dominates the complexity of
this decision algorithm. Our algorithm takes the same time as the other
algorithms from the literature \cite{AHU}, because we start from
non-deterministic automata.

Remark: If we would have required for our automata \fa{A} and \fa{B} that
$\alpha_{\fa{A}}(e) \in X$ and $\alpha_{\fa{B}}(e) \in X$, then the diagram from
the corollary to theorem 5 could have been simplified to \begin{tikzcd}
\fa{A} & \fa{C} \arrow[l] \arrow[r] & \fa{B} \end{tikzcd}. For the compexity of
our decision algorithm this however would be insignificant.

Exercises:

\begin{enumerate}
\item Let \fa{A}, \fa{B}, \fa{C} be finite automata, $\beta_{\fa{A}} : \fa{C}
\to \fa{A},\ \beta_{\fa{B}} : \fa{C} \to \fa{B}$ reductions and $\faequiv{A},
\faequiv{B}$ the equivalence relations from the proof of lemma 1.

Show: $(\faequiv{A}\ \subset\ \faequiv{B}) \Rightarrow$ there exists a reduction
$\beta : \fa{B} \to \fa{A}$ such that the following diagram commutes:
\begin{center}
\begin{tikzcd}
& \fa{C} \arrow[ld,"\beta_{\fa{A}}"] \arrow[rd,"\beta_{\fa{B}}"] \\
\fa{A} & & \fa{B} \arrow[ll,dashed,"\beta"]
\end{tikzcd}
\end{center}

\item Let \fa{A} be a complete, deterministic finite automaton, \fa{B} a finite
automaton and $\beta : \fa{A} \to \fa{B}$ a homomorphism with
$\beta(E_{\fa{A}}) = E_{\fa{B}}$.
Show:
\begin{itemize}
  \item $\beta$ is a reduction
  \item The given requirements are necessary.
\end{itemize}

\end{enumerate}

























